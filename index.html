<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is Corona Spreading?</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/regression@2.0.1/dist/regression.min.js"></script>

    <style>
        h2 {
            font-weight: bold;
        }

        select {
            max-width: 15rem;
            min-width: 15rem;
        }
    </style>
</head>

<body>
    <div class="container">

        <!-- trend chart -->
        <div class="row">
            <div class="col-12 text-center">
                <h2 class="mt-3">Is Corona Spreading?</h2>
                <div class="btn-group btn-group-toggle mt-3" data-toggle="buttons">
                    <label class="btn btn-light active">
                        <input type="radio" name="mode" id="new_case" autocomplete="off"> new case
                    </label>
                    <label class="btn btn-light">
                        <input type="radio" name="mode" id="cumulative" autocomplete="off" checked> cumulative
                    </label>
                </div>
                <div>
                    <canvas id="trend_chart" class="px-5 mt-3"></canvas>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-3">
                <h5>Region</h5>
                <select name="" id="" class="form-control">
                    <option value="china">China</option>
                    <option value="macau">Macau</option>
                    <option value="hong_kong">Hong Kong</option>
                    <option value="taiwan">Taiwan</option>
                </select>
            </div>
            <div class="col-3">
                <h5>Case Type</h5>
                <select name="" id="" class="form-control">
                    <option value="1">comfirmed</option>
                    <option value="2">suspected</option>
                    <option value="3">dead</option>
                    <option value="4">recovered</option>
                </select>
            </div>
            <div class="col-3">
                <h5>Curve Fitting</h5>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
                    <label class="form-check-label" for="exampleRadios1">
                        Sigmoidal
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="option2">
                    <label class="form-check-label" for="exampleRadios2">
                        Exponential
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios3" value="option3">
                    <label class="form-check-label" for="exampleRadios3">
                        Linear
                    </label>
                </div>
            </div>
            <div class="col-3">
                <h5>Prediction Points</h5>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <button class="btn btn-secondary" type="button" id="button-addon1">-</button>
                    </div>
                    <input type="text" class="form-control text-center" value="2" style="max-width: 5rem">
                    <div class="input-group-append">
                        <button class="btn btn-secondary" type="button" id="button-addon2">+</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- death-to-recovery chart -->
        <div class="row mt-5">
            <div class="col-12 text-center">
                <h2 class="mt-3">What is the death-to-recovery ratio?</h2>
                <div class="btn-group btn-group-toggle mt-3" data-toggle="buttons">
                    <label class="btn btn-light active">
                        <input type="radio" name="mode" id="new_case2" autocomplete="off"> new case
                    </label>
                    <label class="btn btn-light">
                        <input type="radio" name="mode" id="cumulative2" autocomplete="off" checked> cumulative
                    </label>
                </div>
                <div>
                    <canvas id="death_to_recovery_chart" class="px-5 mt-3"></canvas>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 d-flex justify-content-center">
                <div>
                    <h5>Region</h5>
                    <select name="" id="" class="form-control">
                        <option value="china">China</option>
                        <option value="macau">Macau</option>
                        <option value="hong_kong">Hong Kong</option>
                        <option value="taiwan">Taiwan</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- region-comparison chart -->

        <!-- percentage chart -->

    </div>

    <script>
        function delta(array) {
            let result = [];
            for (let i = 0; i < array.length - 1; i++) {
                result[i] = array[i+1] - array[i];
            }
            return result;
        }

        let china = {
            dates: ["2020-01-20", "2020-01-21", "2020-01-22", "2020-01-23", "2020-01-24", "2020-01-25", "2020-01-26", "2020-01-27", "2020-01-28", "2020-01-29", "2020-01-30", "2020-01-31", "2020-02-01"],
            confirmed: [291, 440, 571, 830, 1287, 1975, 2744, 4515, 5974, 7711, 9692, 11791, 14380],
            dead: [6, 9, 17, 25, 41, 56, 80, 106, 132, 170, 213, 259, 304],
            recovered: [25, 25, 25, 34, 38, 49, 51, 60, 103, 124, 171, 243, 328]
        };

        let input = china.confirmed.map( (value, index) => [index, value]);  //make an array of [x,y] pairs
        const output = regression.exponential(input);
        let exponentialFit = output.points.map(pair => pair[1]);

        china.dates.push("2020-02-02");
        exponentialFit.push(output.predict(output.points.length)[1]);  // add 1 prediction point
        china.dates.push("2020-02-03");
        exponentialFit.push(output.predict(output.points.length + 1)[1]);  // add 1 more prediction point

        let cumulativeData = {
            labels: china.dates,
            datasets: [{
                label: "confirmed",
                backgroundColor: "#f44336",
                borderColor: "#f44336",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: china.confirmed
            }, {
                label: "dead",
                backgroundColor: "#424242",
                borderColor: "#424242",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: china.dead,
                hidden: true  // set to null to show
            }, {
                label: "recovered",
                backgroundColor: "#64dd17",
                borderColor: "#64dd17",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: china.recovered,
                hidden: true  // set to null to show
            }, {
                label: "exponential",
                borderColor: "#888888",
                pointRadius: 0,
                borderDash: [5,5],
                fill: false,
                data: exponentialFit
            }]
        };

        let newCaseData = {
            labels: china.dates.slice(1), //remove first date
            datasets: [{
                label: "confirmed",
                backgroundColor: "#f44336",
                borderColor: "#f44336",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: delta(china.confirmed)
            }, {
                label: "dead",
                backgroundColor: "#424242",
                borderColor: "#424242",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: delta(china.dead),
                hidden: true  // set to null to show
            }, {
                label: "recovered",
                backgroundColor: "#64dd17",
                borderColor: "#64dd17",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: delta(china.recovered),
                hidden: true  // set to null to show
            }]
        }

        let chartOptions = {
            legend: {
                position: "right"
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Date'
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Number of Person'
                    }
                }]
            },
        };

        let coronaChartContext = document.getElementById("trend_chart").getContext("2d");
        let coronaChart = new Chart(coronaChartContext, { type: "line", data: cumulativeData, options: chartOptions });



        $("#new_case").on("click", function() {
            coronaChart.destroy();
            coronaChart = new Chart(coronaChartContext, { type: "line", data: newCaseData, options: chartOptions });
        })

        $("#cumulative").on("click", function () {
            coronaChart.destroy();
            coronaChart = new Chart(coronaChartContext, { type: "line", data: cumulativeData, options: chartOptions });
        })

        // this.chart.getDatasetMeta(legendItem.datasetIndex).hidden = true
        // this.chart.update()
        // see   https://codepen.io/jordanwillis/pen/BWKKKo?editors=0010

    </script>
</body>

</html>