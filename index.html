<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is Corona Spreading?</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

    <style>
    
    </style>
</head>

<body>
    <div class="container">

        <div class="row mt-5">
            <div class="col-12 text-center">
                <h1>Is Corona Spreading?</h1>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12 text-center">
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <label class="btn btn-light active">
                        <input type="radio" name="mode" id="new_case" autocomplete="off"> new case
                    </label>
                    <label class="btn btn-light">
                        <input type="radio" name="mode" id="cumulative" autocomplete="off" checked> cumulative
                    </label>
                </div>
                <canvas id="corona_chart" class="px-5 mt-3"></canvas>
            </div>
        </div>

    </div>

    <script>
        function delta(array) {
            let result = [];
            for (let i = 0; i < array.length - 1; i++) {
                result[i] = array[i+1] - array[i];
            }
            return result;
        }

        const china = {
            dates: ["2020-01-20", "2020-01-21", "2020-01-22", "2020-01-23", "2020-01-24", "2020-01-25", "2020-01-26", "2020-01-27", "2020-01-28", "2020-01-29", "2020-01-30", "2020-01-31", "2020-02-01"],
            confirmed: [291, 440, 571, 830, 1287, 1975, 2744, 4515, 5974, 7711, 9692, 11791, 14380],
            dead: [6, 9, 17, 25, 41, 56, 80, 106, 132, 170, 213, 259, 304],
            recovered: [25, 25, 25, 34, 38, 49, 51, 60, 103, 124, 171, 243, 328]
        };

        let cumulativeData = {
            labels: china.dates,
            datasets: [{
                label: "confirmed",
                backgroundColor: "#f44336",
                borderColor: "#f44336",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: china.confirmed
            }, {
                label: "dead",
                backgroundColor: "#424242",
                borderColor: "#424242",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: china.dead,
                hidden: true  // set to null to show
            }, {
                label: "recovered",
                backgroundColor: "#64dd17",
                borderColor: "#64dd17",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: china.recovered,
                hidden: true  // set to null to show
            }]
        };

        let newCaseData = {
            labels: china.dates.slice(1), //remove first date
            datasets: [{
                label: "confirmed",
                backgroundColor: "#f44336",
                borderColor: "#f44336",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: delta(china.confirmed)
            }, {
                label: "dead",
                backgroundColor: "#424242",
                borderColor: "#424242",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: delta(china.dead),
                hidden: true  // set to null to show
            }, {
                label: "recovered",
                backgroundColor: "#64dd17",
                borderColor: "#64dd17",
                pointRadius: 6,
                pointHoverRadius: 10,
                showLine: false,
                data: delta(china.recovered),
                hidden: true  // set to null to show
            }]
        }

        let chartOptions = {
            legend: {
                position: "right"
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Date'
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Number of Person'
                    }
                }]
            },
        };

        let coronaChartContext = document.getElementById("corona_chart").getContext("2d");
        let coronaChart = new Chart(coronaChartContext, { type: "line", data: cumulativeData, options: chartOptions });



        $("#new_case").on("click", function() {
            coronaChart.destroy();
            coronaChart = new Chart(coronaChartContext, { type: "line", data: newCaseData, options: chartOptions });
        })

        $("#cumulative").on("click", function () {
            coronaChart.destroy();
            coronaChart = new Chart(coronaChartContext, { type: "line", data: cumulativeData, options: chartOptions });
        })

        // this.chart.getDatasetMeta(legendItem.datasetIndex).hidden = true
        // this.chart.update()
        // see   https://codepen.io/jordanwillis/pen/BWKKKo?editors=0010

    </script>
</body>

</html>